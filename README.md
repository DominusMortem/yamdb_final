![workflow](https://github.com/DominusMortem/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

## Проект YaMDb
### Разработчики: Попов Серафим, Уколов Алексей и Зиннуров Рамиль
Проект YaMDb собирает отзывы (Review) пользователей на произведения (Titles). Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список категорий (Category) может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).

Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.

В каждой категории есть произведения: книги, фильмы или музыка. Например, в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха.

Произведению может быть присвоен жанр (Genre) из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.
Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы (Review) и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). На одно произведение пользователь может оставить только один отзыв.

### Шаблон наполнения файла .env:

```
SECRET_KEY=yoursecretkey # указываем свой секретный ключ 
DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=postgres # логин для подключения к базе данных
POSTGRES_PASSWORD=postgres # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД
```


### Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:
```
git clone https://github.com/DominusMortem/yamdb_final
```
Запушить к себе в репозиторий:

```
git add .
git commit -m 'текст комментария'
git push
```
Во вкладке Settings -> Secrets -> Action
Добавить переменные окружения.

Подключится к серверу по SSH
```
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py collectstatic --no-input
```
Для наполнения базы данных разместите файл fixtures.json в папке infra_sp2\api_yamdb:
```
docker-compose exec web python manage.py loaddata fixtures.json
```

### Технологии:
Python 3.7
Django 3.0
Django REST Framework 3.12.4
Simple JWT 5.1
PostrgeSQL
Gunicorn
Nginx

# Алгоритм регистрации пользователей
1. Пользователь отправляет POST-запрос на добавление нового пользователя с параметрами `email` и `username` на эндпоинт `/api/v1/auth/signup/`.
2. **YaMDB** отправляет письмо с кодом подтверждения (`confirmation_code`) на адрес  `email`.
3. Пользователь отправляет POST-запрос с параметрами `username` и `confirmation_code` на эндпоинт `/api/v1/auth/token/`, в ответе на запрос ему приходит `token` (JWT-токен).
4. При желании пользователь отправляет PATCH-запрос на эндпоинт `/api/v1/users/me/` и заполняет поля в своём профайле (описание полей — в документации).

# Пользовательские роли
- **Аноним** — может просматривать описания произведений, читать отзывы и комментарии.
- **Аутентифицированный пользователь** (`user`) — может, как и **Аноним**, читать всё, дополнительно он может публиковать отзывы и ставить оценку произведениям (фильмам/книгам/песенкам), может комментировать чужие отзывы; может редактировать и удалять **свои** отзывы и комментарии. Эта роль присваивается по умолчанию каждому новому пользователю.
- **Модератор** (`moderator`) — те же права, что и у **Аутентифицированного пользователя** плюс право удалять **любые** отзывы и комментарии.
- **Администратор** (`admin`) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям. 
- **Суперюзер Django** — обладет правами администратора (`admin`)

Запросы к API начинаются с ```/api/v1/```
### Примеры запросов:

/auth/signup/:
POST
Регистрация нового пользователя
Получить код подтверждения на переданный `email`.
Права доступа: **Доступно без токена.**
Использовать имя 'me' в качестве `username` запрещено.
Поля `email` и `username` должны быть уникальными.
```
{
  "email": "string",
  "username": "string"
}
200: 'Удачное выполнение запроса'
	{
	  "email": "string",
      "username": "string"
	}
400: 'Отсутствует обязательное поле или оно некорректно'
```


/auth/token/:
POST
Получение JWT-токена в обмен на username и confirmation code.
Права доступа: **Доступно без токена.**
```
{
  "username": "string",
  "confirmation_code": "string"
}
200: 'Удачное выполнение запроса'
	{
      "token": "string"
	}
400: 'Отсутствует обязательное поле или оно некорректно'
404: 'Пользователь не найден'
```

 /categories/:
GET
Получение списка всех категорий
        Права доступа: **Доступно без токена**
```
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```

 /genres/:
GET
Получение списка всех жанров
Права доступа: **Доступно без токена**
``` 
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```
POST
Добавление жанра
Права доступа: **Администратор**.
Поле `slug` каждого жанра должно быть уникальным.
```
{
  "name": "string",
  "slug": "string"
}
      responses:
        201:
          {
			"name": "string",
			"slug": "string"
		  }
        400:
          description: 'Отсутствует обязательное поле или оно некорректно'
        401:
          description: Необходим JWT-токен
        403:
          description: Нет прав доступа
```

  /genres/{slug}/:
DELETE
Удаление жанра
Права доступа: **Администратор**.
```
      responses:
        204:
          description: 'Удачное выполнение запроса'
        401:
          description: Необходим JWT-токен
        403:
          description: Нет прав доступа
        404:
          description: Жанр не найден
```

/titles/:
GET
Получить список всех объектов.
Права доступа: **Доступно без токена**
```
200: 'Удачное выполнение запроса'
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "id": 0,
        "name": "string",
        "year": 0,
        "rating": 0,
        "description": "string",
        "genre": [
          {
            "name": "string",
            "slug": "string"
          }
        ],
        "category": {
          "name": "string",
          "slug": "string"
        }
      }
    ]
  }
]
```
POST
Добавить новое произведение.
Права доступа: **Администратор**.
Нельзя добавлять произведения, которые еще не вышли (год выпуска не может быть больше текущего).
При добавлении нового произведения требуется указать уже существующие категорию и жанр.
```
{
  "name": "string",
  "year": 0,
  "description": "string",
  "genre": [
    "string"
  ],
  "category": "string"
}
201: 'Удачное выполнение запроса'
	{
	  "id": 0,
	  "name": "string",
	  "year": 0,
	  "rating": 0,
	  "description": "string",
	  "genre": [
		{
		  "name": "string",
		  "slug": "string"
		}
	  ],
	  "category": {
		"name": "string",
		"slug": "string"
	  }
	}
400: 'Отсутствует обязательное поле или оно некорректно' 
401: 'Необходим JWT-токен'
403: 'Нет прав доступа'
```
